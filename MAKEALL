#!/bin/sh
# A trivial script to build with all known configurations
# (please add a configs/ file to test your special case)

C=$(mktemp /tmp/wrpc-config.XXXXXX); remove_tmp_c=true
B=$(mktemp /tmp/wrpc-build.XXXXXX); remove_tmp_b=true

configs=$(ls configs)
for c in $configs; do
    echo "##### Building with '$c'"
    echo "##### Building with '$c'" >> $B
    echo "##### Configuiring for '$c'" >> $C
    if ! make -s $c 2>&1 >> $C; then
	echo "Error in configuration (see $C)"
	remove_tmp_c=false
    fi
    make -s clean
    if ! make  -j5  2>&1 >> $B; then
	echo "Build error (see $B)"
	remove_tmp_b=false
    fi
    test -f ppsi.o && size ppsi.o
    test -f ppsi && size ppsi | tail -n 1

done
if $remove_tmp_c; then rm $C; fi
if $remove_tmp_b; then rm $B; fi
